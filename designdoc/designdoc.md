# ML System Design Doc

## Дизайн ML-системы - Prediction of compressor equipment failure

## 1. Цели и предпосылки

### 1.1 Зачем идем в разработку продукта?
- Бизнес-цель и задачи:
    - Целью разработки и внедрения данного проекта является снижение затрат на ремонт компрессорного оборудования в подвижном составе железных дорог, а также повышение качества и безопасности предоставляемых услуг по перевозке.
    - Ключевые задачи: 
        - создание отказоустойчивой системы, считывающей показания датчиков компрессорного оборудования и создающей достаточно точные прогнозы поломки оборудования в ближайшем времени.

- Почему станет лучше, чем сейчас, от использования ML
    - На текущий момент появление неисправностей идет по следующим сценариям:
        1. резкое появление неисправности при использовании (резкое падение давления при активном торможении);
        2. появление неисправности при кратковременной остановке;
        3. появление неисправности при стоянке поезда;
        4. появление неисправности в отдельно стоящем вагоне (при условии нахождении в нем подключенного компрессорного оборудования - части пневматической тормозной системы).
    - При любом из сценариев поломки компрессорного оборудования, являющегося частью пневматической тормозной системы, и дальнейшем использовании оборудования с неисправностью возрастает вероятность нестандартных ситуаций, в том числе аварий и увеличение ущерба подвижному составу.
    - Создаваемый проект, рассчитан на предотвращение использования неисправного компрессорного оборудования при сценариях 1-3.
    - Что будем считать успехом с точки зрения бизнеса
        - Для измерения критерия успеха используем критерии окупаемости системы и безопасности пассажиров.

        - Для оценки будем использовать следующие ключевые показатели:
            1. сэкономленные средства, идущие на полное восстановление оборудования;
            2. стоимость внедрения проекта;
            3. общая безопасность пассажиров (зависит от количества аварий и общего пассажиропотока)

- Стоимость
    - Затраты на работу it-специалистов: включает зарплаты и прочие расходы, связанные с наймом и содержанием команды it-специалистов, занимающихся разработкой и обслуживанием ML-проектов.
    - Затраты на внедрение проекта в отдельные единицы подвижного состава.

    В случае, если затраты на разработку и внедрение проекта превысят средства, которые удалось сэкономить за N месяцев после запуска проекта, необходимо поставить вопрос о переориентации задач исследования. 

### 1.2 Бизнес-требования и ограничения
Бизнес-требования и ограничения к проекту включают в себя:
- создание и интеграция модели, которая может обрабатывать входные данные, поступающие с датчиков оборудования, чтобы прогнозировать поломки;
- высокая точность модели, чтобы не прогнозировать часто ложноположительные прогнозы, ведущие к лишним затратам, а также чтобы не получать ложноотрицательные, ведущие к поломкам и авариям;
- возможность параллельно обрабатывать несколько потоков данных (так как компрессоров в поезде может быть несколько);
- отказоустойчивость системы;
- быстрая работа системы - ответ модели по запросу должен быть менее 8 секунд.

### 1.3 Что входит в скоуп проекта, что не входит
- Что не будет сделано:
    - проект не сможет решить прогнозирование поломок в других системах поезда, других узлах тормозной системы, кроме как в компрессорах тормозной системы;
    - в рамках проекта не будут проработаны действия, которые должны быть совершены, при получении положительного прогноза поломки.
- Описание результата с точки зрения качества кода и воспроизводимости решения
    - Результат проекта будет включать в себя четко описанный и документированный код, который можно легко внедрить в существующую систему. Модель должна быть обучена и протестирована, а ее производительность должна быть оценена с использованием отдельного тестового набора данных. Код будет структурирован таким образом, чтобы обеспечить воспроизводимость (фиксация: `random seed`, `гипер-параметры модели`, `метрик`, `модель`)
- Описание планируемого технического долга
    - Возможные аспекты технического долга могут включать улучшение качества работы модели.

### 1.4 Предпосылки решения
- **Данные.** Наше решение будет базироваться на данных, собранных при работе компрессора в метропоезде на протяжении 7 месяцев. Мы предполагаем, что эти данные достаточно полны и точны для обучения модели машинного обучения.

- **Горизонт прогноза или режим работы:** онлайн.

- **Процесс.** Мы предполагаем, что модель будет интегрирована в существующую систему управления в кабинах метропоездов.

### 1.5 Бизнес-метрики

Определяем ключевые показатели, которые далее агрегируем в единую формулу в деньгах, понятную бизнесу. Показателями являются:

- количество поломок компрессорного оборудования за период времени;
- безопасность пассажирских перевозок.

Определим profit в деньгах как основную бизнес метрику на основе этих показателей

$$
profit = \sum_{}^{TN+TP}\space economy *\space \lambda\space - \sum_\space costs - \sum_{}^{FN+FP}\space costs
$$

Сумма сэкономленных средств идущих на полное восстановление оборудования
$$ \sum_{}^{TN+TP}\space economy $$

Общий индекс безопасности (зависит от количества аварий и общего пассажиропотока)
$$ \lambda $$

Сумма затрат на создание и интеграцию проекта
$$ \sum_\space costs $$

Сумма затрат, получаемых при ложных прогнозах модели
$$ \sum_{}^{FN+FP}\space costs $$

## 2. Методология

### 2.1 Постановка задачи

Задача бинарной классификации с большим дисбалансом классов.

### 2.2 Блок-схема решения

### 2.3 Этапы решения задачи

### 2.3.1 Выбор метрик

### 2.3.2 Определение объекта и таргета

### 2.3.3 Подготовка данных

### 2.3.4 Валидация

### 2.3.5 Выбор архитектуры модели для решения задачи
